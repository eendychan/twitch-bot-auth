<!DOCTYPE html>
<html>
<head>
    <title>Processing Authorization</title>
    <style>
        body { font-family: Arial; text-align: center; margin-top: 50px; }
        .success { color: green; }
        .error { color: red; }
        .token-box { background: #f0f0f0; padding: 15px; margin: 20px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="message">
        <h2>Processing Authorization...</h2>
    </div>

    <script>
        // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ URL
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const token = params.get('access_token');

        if (token) {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–∫–µ–Ω —Å—Ä–∞–∑—É (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ Pastebin –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç)
            document.getElementById('message').innerHTML = `
                <div class="success">
                    <h2>‚úÖ Authorization Successful!</h2>
                    <div class="token-box">
                        <strong>Token received:</strong><br>
                        <code>${token.substring(0, 25)}...</code>
                    </div>
                    <p>Saving to Pastebin...</p>
                </div>
            `;

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Pastebin
            fetch('/api/save-token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    token: token,
                    channel: 'twitch_channel'
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('message').innerHTML = `
                        <div class="success">
                            <h2>‚úÖ Token Saved to Pastebin!</h2>
                            <p>Token has been securely stored</p>
                            <p><small>Paste URL: ${data.paste_url || 'Saved'}</small></p>
                            <div class="token-box">
                                <strong>Token preview:</strong><br>
                                <code>${token.substring(0, 25)}...</code>
                            </div>
                            <p>You can close this window now</p>
                        </div>
                    `;
                } else {
                    document.getElementById('message').innerHTML = `
                        <div class="error">
                            <h2>‚ö†Ô∏è Pastebin Error</h2>
                            <p>But token was received:</p>
                            <div class="token-box">
                                <code>${token}</code>
                            </div>
                            <p>Please copy this token manually</p>
                            <button onclick="copyToken()">üìã Copy Token</button>
                        </div>
                    `;
                }
            })
            .catch(error => {
                document.getElementById('message').innerHTML = `
                    <div class="error">
                        <h2>‚ö†Ô∏è Server Error</h2>
                        <p>But token was received:</p>
                        <div class="token-box">
                            <code>${token}</code>
                        </div>
                        <p>Please copy this token manually</p>
                        <button onclick="copyToken()">üìã Copy Token</button>
                    </div>
                `;
            });

            function copyToken() {
                navigator.clipboard.writeText(token);
                alert('Token copied to clipboard!');
            }

        } else {
            document.getElementById('message').innerHTML = `
                <div class="error">
                    <h2>‚ùå Authorization Failed</h2>
                    <p>No token received from Twitch.</p>
                    <button onclick="window.location.href = '/'">‚Üê Back to Home</button>
                </div>
            `;
        }
    </script>
</body>
</html>
