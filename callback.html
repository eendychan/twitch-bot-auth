<script>
    // Извлекаем токен из URL
    const hash = window.location.hash.substring(1);
    const params = new URLSearchParams(hash);
    const token = params.get('access_token');
    
    if (token) {
        document.getElementById('message').innerHTML = `
            <div class="success">✅ Авторизация успешна!</div>
            <p>Токен получен. Сохраняем...</p>
            <p><small>Токен: ${token.substring(0, 15)}...</small></p>
        `;
        
        // Отправляем токен на Netlify функцию
        fetch('/.netlify/functions/save-token', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ token: token })
        })
        .then(response => response.json())
        .then(data => {
            console.log('✅ Token saved:', data);
            document.getElementById('message').innerHTML += `
                <p style="color: green;">✅ Токен сохранен на сервере!</p>
            `;
        })
        .catch(error => {
            console.error('❌ Error saving token:', error);
            document.getElementById('message').innerHTML += `
                <p style="color: red;">⚠️ Ошибка сохранения, но токен: ${token}</p>
            `;
        });
        
    } else {
        document.getElementById('message').innerHTML = `
            <div class="error">❌ Ошибка авторизации</div>
            <p>Токен не получен. Попробуйте снова.</p>
        `;
    }
</script>
